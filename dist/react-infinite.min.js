!function(e,t){"function"==typeof define&&define.amd?define(["react"],t):"object"==typeof exports?module.exports=t(require("react")):e.Infinite=t(e.React)}(this,function(e){var t=e.createClass({displayName:"Infinite",propTypes:{handleScroll:e.PropTypes.func,preloadBatchSize:e.PropTypes.number,preloadAdditionalHeight:e.PropTypes.number,elementHeight:e.PropTypes.number.isRequired,containerHeight:e.PropTypes.number.isRequired,infiniteLoadBeginBottomOffset:e.PropTypes.number,onInfiniteLoad:e.PropTypes.func,loadingSpinnerDelegate:e.PropTypes.node,isInfiniteLoading:e.PropTypes.bool,timeScrollStateLastsForAfterUserScrolls:e.PropTypes.number,className:e.PropTypes.string},getDefaultProps:function(){return{handleScroll:function(){},loadingSpinnerDelegate:e.DOM.div(null),onInfiniteLoad:function(){},isInfiniteLoading:!1,timeScrollStateLastsForAfterUserScrolls:150}},getInitialState:function(){var e=this.props.preloadBatchSize?this.props.preloadBatchSize:this.props.containerHeight/2,t=this.props.preloadAdditionalHeight?this.props.preloadAdditionalHeight:this.props.containerHeight,i=Math.min(this.props.children.length,Math.ceil((e+t)/this.props.elementHeight));return{numberOfChildren:this.props.children.length,scrollableHeight:void 0,displayIndexStart:0,displayIndexEnd:i,isInfiniteLoading:!1,currentScrollTop:void 0,previousScrollTop:void 0,preloadBatchSize:e,preloadAdditionalHeight:t,scrollTimeout:void 0,isScrolling:!1,extendedScrolledPast:!1,topItemIndex:0,selectedItem:0}},componentWillReceiveProps:function(e){var t=this,i={};void 0!==e.isInfiniteLoading&&(i.isInfiniteLoading=e.isInfiniteLoading);var o=e.preloadBatchSize;i.preloadBatchSize=o?o:e.containerHeight/2;var l=e.preloadAdditionalHeight;i.preloadAdditionalHeight=l?l:e.containerHeight;var r=e.selectedItem;i.selectedItem=r?r:0,this.props.selectedItem!==r?this.setState(i,function(){t.setScrollTop(this.props.elementHeight*r),t.setStateFromScrollTop(this.props.elementHeight*r)}):this.setState(i,function(){t.setStateFromScrollTop(t.getScrollTop())})},componentDidUpdate:function(e){this.props.children.length!==e.children.length&&this.setStateFromScrollTop(this.getScrollTop())},componentWillMount:function(){if(1===e.Children.count(this.props.children))throw new Error("Infinite does not do anything with only one child.")},componentDidMount:function(){this.setState({scrollableHeight:this.refs.scrollable.getDOMNode().clientHeight,currentScrollTop:this.getScrollTop(),previousScrollTop:this.getScrollTop()})},computeTotalScrollableHeight:function(){return this.props.elementHeight*this.props.children.length+(this.state.extendedScrolledPast?0:this.props.extendedHeight)},setScrollTop:function(e){this.refs.scrollable.getDOMNode().scrollTop=e},getScrollTop:function(){return this.refs.scrollable.getDOMNode().scrollTop},isScrollingDown:function(){return this.state.previousScrollTop<this.state.currentScrollTop},setStateFromScrollTop:function(e){var t=Math.floor(e/this.state.preloadBatchSize),i=this.state.preloadBatchSize*t;this.props.extendedBlock<t&&(i-=this.props.extendedHeight);var o=i+this.state.preloadBatchSize,l=Math.max(0,i-this.state.preloadAdditionalHeight),r=Math.min(this.computeTotalScrollableHeight(),o+this.state.preloadAdditionalHeight),s=Math.floor(e/this.props.elementHeight),n=Math.floor(l/this.props.elementHeight),a=Math.ceil(r/this.props.elementHeight);this.state.topItemIndex!=s&&this.props.scrollNumberCallback&&this.props.scrollNumberCallback(s),this.setState({displayIndexStart:n,displayIndexEnd:a,currentScrollTop:e,previousScrollTop:this.state.currentScrollTop,extendedScrolledPast:this.props.extendedIndex<n,topItemIndex:s})},infiniteHandleScroll:function(e){this.props.handleScroll(this.refs.scrollable.getDOMNode()),this.handleScroll(e.target.scrollTop)},manageScrollTimeouts:function(){this.state.scrollTimeout&&clearTimeout(this.state.scrollTimeout);var e=this,t=setTimeout(function(){e.setState({isScrolling:!1,scrollTimeout:void 0})},this.props.timeScrollStateLastsForAfterUserScrolls);this.setState({isScrolling:!0,scrollTimeout:t})},handleScroll:function(e){this.manageScrollTimeouts(),this.setStateFromScrollTop(e);var t=e>this.computeTotalScrollableHeight()-this.props.containerHeight-this.props.infiniteLoadBeginBottomOffset;t&&!this.state.isInfiniteLoading&&(this.setState({isInfiniteLoading:!0}),this.props.onInfiniteLoad())},buildScrollableStyle:function(){return{height:this.props.containerHeight,overflowX:"hidden",overflowY:"scroll","-webkit-overflow-scrolling":"touch"}},buildHeightStyle:function(e){return{width:"100%",height:Math.ceil(e)+"px"}},render:function(){var t=this.state.displayIndexStart*this.props.elementHeight+(this.state.extendedScrolledPast?this.props.extendedHeight:0),i=(this.props.children.length-this.state.displayIndexEnd)*this.props.elementHeight,o=this.props.children.slice(this.state.displayIndexStart,this.state.displayIndexEnd),l={};return this.state.isScrolling&&(l.pointerEvents="none"),e.DOM.div({className:this.props.className?this.props.className:"",ref:"scrollable",style:this.buildScrollableStyle(),onScroll:this.infiniteHandleScroll},e.DOM.div({ref:"smoothScrollingWrapper",style:l},e.DOM.div({ref:"topSpacer",style:this.buildHeightStyle(t)}),o,e.DOM.div({ref:"bottomSpacer",style:this.buildHeightStyle(i)}),e.DOM.div({ref:"loadingSpinner"},this.state.isInfiniteLoading?this.props.loadingSpinnerDelegate:null)))}});return t});